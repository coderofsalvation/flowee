<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>flowee</title>
<link rel="stylesheet" href="https://cdn.rawgit.com/coderofsalvation/flowee/gh-pages/css/air.css">
</head>
<body>

<a href="https://github.com/coderofsalvation/flowee#readme"><img style="max-width:none; position: absolute; top: 0; left: 0; border: 0;border-radius:0; height:auto;width:auto;" src="https://camo.githubusercontent.com/8b6b8ccc6da3aa5722903da7b58eb5ab1081adee/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"></a>
<a href="/"><img alt="" src="http://flowee.isvery.ninja/img/flowee.png"/></a>
<hr>
<h2>
<a id="user-content-data-logic--permissions--authentication" class="anchor" href="#data-logic--permissions--authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data logic / Permissions / Authentication</h2>

<p>Database access can be supervised by introducing <a href="http://fortunejs.com/api/">fortunejs transformers</a>:</p>

<pre><code>const errors = require('fortune').errors

flowee.store.transformOutput(type, (context, record) =&gt; {
  if (context.request.meta['Authorization'] !== 'secret')
    throw new errors.UnauthorizedError('Not allowed to view this resource.')
  return record
})
</code></pre>

<p>In a similar way this can be done with custom endpoints by introducing authentication middleware <strong>before</strong> flowee 
is started.
For example using <a href="https://www.npmjs.com/package/rest-auth">rest-auth</a>:</p>

<pre><code>var auth = require('rest-auth');

// Tell the auth module how to authenticate a user 
auth.authenticateUser(function(username, password, callback) {
    /* TODO: use nedb in example, not mongodb */
    User.findOne({ username: username }, function(err, user) {
        if (err) {
            return callback(err);
        }
        if (! user) {
            return callback(null, false, 'User does not exists');
        }
        if (hash(password) !== user.password) {
            return callback(null, false, 'Invalid password');
        }
        // The username and password should be given here 
        callback(null, {
            username: username,
            password: user.password
        });
    });
});:

flowee.use(auth.authenticate({
    expires: '2 hours',
    authRoute: 'auth-token',
    authTokenHash: {
        algorithm: 'sha256',
        salt: 'saltiness'
    }
});

flowee.start(model, function(server, router) {
  ..
</code></pre>
<center>
  generated at Tue Dec 15 22:41:49 CET 2015
</center>
</body>
</html>