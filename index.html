<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>flowee</title>
<link rel="stylesheet" href="css/air.css">
</head>
<body>

<a href="https://github.com/coderofsalvation/flowee#readme"><img style="max-width:none; position: absolute; top: 0; left: 0; border: 0;border-radius:0; height:auto;width:auto;" src="https://camo.githubusercontent.com/8b6b8ccc6da3aa5722903da7b58eb5ab1081adee/68747470733a2f2f73332e616d617a6f6e6177732e636f6d2f6769746875622f726962626f6e732f666f726b6d655f6c6566745f6f72616e67655f6666373630302e706e67" alt="Fork me on GitHub" data-canonical-src="https://s3.amazonaws.com/github/ribbons/forkme_left_orange_ff7600.png"></a>
<h1>
<a id="user-content-flowee" class="anchor" href="#flowee" aria-hidden="true"><span class="octicon octicon-link"></span></a>Flowee</h1>

<p><a href="https://camo.githubusercontent.com/60752b08637ed20755e1cef2ad44597775048016/687474703a2f2f636f6465726f6673616c766174696f6e2e6769746875622e696f2f666c6f7765652f696d672f666c6f7765652e706e67" target="_blank"><img src="https://camo.githubusercontent.com/60752b08637ed20755e1cef2ad44597775048016/687474703a2f2f636f6465726f6673616c766174696f6e2e6769746875622e696f2f666c6f7765652f696d672f666c6f7765652e706e67" alt="" data-canonical-src="http://coderofsalvation.github.io/flowee/img/flowee.png" style="max-width:100%;"></a></p>

<p>a <strong>lightweight</strong> way to <em>create JSONAPI-compatible api's_</em> using <em>nodejs</em>:</p>

<h2>
<a id="user-content-architecture" class="anchor" href="#architecture" aria-hidden="true"><span class="octicon octicon-link"></span></a>Architecture</h2>

<p><a href="https://camo.githubusercontent.com/80e2d26fdea7eae50e497e06cce905cec52a720e/687474703a2f2f636f6465726f6673616c766174696f6e2e6769746875622e696f2f666c6f7765652f696d672f6469616772616d2e706e67" target="_blank"><img src="https://camo.githubusercontent.com/80e2d26fdea7eae50e497e06cce905cec52a720e/687474703a2f2f636f6465726f6673616c766174696f6e2e6769746875622e696f2f666c6f7765652f696d672f6469616772616d2e706e67" alt="" data-canonical-src="http://coderofsalvation.github.io/flowee/img/diagram.png" style="max-width:100%;"></a></p>

<p>click <a href="http://coderofsalvation.github.io/flowee/img/diagram.png" target="_blank">here</a> to see the fullscreen architecture</p>

<ul>
<li>fast installation: core is +/- 10M</li>
<li>built on the shoulders of <a href="http://fortunejs.com/">fortunejs</a> for automatic <strong>json 2 relational database</strong> mapping</li>
<li>
<a href="http://www.slideshare.net/apigee/i-love-apis-2015-create-designdriven-apis-with-nodejs-and-swagger">DDA</a>: design-driven api by using a json model </li>
<li>
<strong>SWAGGER v2</strong> compatible json model</li>
<li>
<a href="http://jsonapi.org/">JSONAPI v1</a> compatible</li>
<li>
<strong>middleware compatible</strong>: connect <a href="http://expressjs.com">express</a> and <a href="http://restify.com">restify</a> middleware modules from npm</li>
<li>by default <em>Flowee</em> runs out of the box using <strong>NeDB</strong>, a <strong>mongodb</strong>-ish disk-persistent memory db</li>
<li>database adapter swappable with <a href="https://www.npmjs.com/package/fortune-mongodb">MongoDB</a>, <a href="https://www.npmjs.com/package/fortune-postgres">Postgres</a>, <a href="https://www.npmjs.com/package/fortune-redis">Redis</a> adapter</li>
</ul>

<h2>
<a id="user-content-getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting started</h2>

<pre><code>$ npm install flowee
$ cp node_modules/flowee/test/model.js .
</code></pre>

<p><strong>Create <code>server.js</code>:</strong></p>

<pre><code>var flowee = require('flowee')
var model = require('./model.js');

flowee.start(model, function(server, router) {
  return server.listen(1337);
});
</code></pre>

<p>( See <a href="https://github.com/coderofsalvation/flowee/blob/master/test/model.js">model.js here</a> )</p>

<pre><code>$ node server.js
</code></pre>

<blockquote>
<p>Voila! Now you have a server running with automatically mapped database entities (incl. <strong>many to many</strong> relations OHMY).</p>
</blockquote>

<h2>
<a id="user-content-howto-database-entities--relations" class="anchor" href="#howto-database-entities--relations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Howto: Database entities &amp; relations</h2>

<p>The <code>definitions</code> field in the <strong>SWAGGER</strong> jsonmodel defines the entities and their relationships:</p>

<pre><code>  }
},
definitions: {          &lt;-- here the database entities are defined
  user: {               &lt;-- name of the entity, this translates to api endpoint '/user' and '/user:id'
    name: {             &lt;-- attribute 
      type: String      &lt;-- type of the attribute
...
</code></pre>

<p>It uses the <strong>fortunejs</strong> <code>defineType</code> format: see docs at <a href="http://fortunejs.com/">fortunejs</a></p>

<h2>
<a id="user-content-howto-custom-endpoints" class="anchor" href="#howto-custom-endpoints" aria-hidden="true"><span class="octicon octicon-link"></span></a>Howto: custom endpoints</h2>

<p>This can be done using the router object :</p>

<pre><code>flowee.start(model, function(server, router) {

  router.get('/foo', function(req, res, next) {          // &lt;--
    return res.end('{"msg":"Hello foo"}');               // &lt;--
  });                                                    // &lt;--

  server.listen(port);
</code></pre>

<p>Or directly using <code>definitions</code> field in the <strong>SWAGGER</strong> jsonmodel defines the entities and their relationships:</p>

<pre><code>  }
},
paths: {
  '/': {                                                   &lt;-- endpoint path 
    'get': {
      'description': 'returns hellow world'               
      'produces': ['application/json'],
      'responses': {
        '200': {
          'description': 'A list of owners.',              &lt;-- useful for generated
          'schema': {                                      &lt;-- documentation
            'type': 'object',                              &lt;--
            'properties':{
              'msg': {'type':"string"}
            }
          }
        }
      },
      func: function(req, res, next) {                     &lt;-- endpoint function
        res.write('{"msg":"Hello world"}');
        res.end();
        return next();
</code></pre>

<h2>
<a id="user-content-data-logic--permissions--authentication" class="anchor" href="#data-logic--permissions--authentication" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data logic / Permissions / Authentication</h2>

<p>Database access can be supervised by introducing <a href="http://fortunejs.com/api/">fortunejs transformers</a>:</p>

<pre><code>const errors = fortune.errors

store.transformOutput(type, (context, record) =&gt; {
  if (context.request.meta['Authorization'] !== 'secret')
    throw new errors.UnauthorizedError('Not allowed to view this resource.')

  return record
})
</code></pre>

<p>In a similar way this can be done with custom endpoints by introducing authentication middleware <strong>before</strong> flowee 
is started.
For example using <a href="https://www.npmjs.com/package/rest-auth">rest-auth</a>:</p>

<pre><code>var auth = require('rest-auth');

// Tell the auth module how to authenticate a user 
auth.authenticateUser(function(username, password, callback) {
    /* TODO: use nedb in example, not mongodb */
    User.findOne({ username: username }, function(err, user) {
        if (err) {
            return callback(err);
        }
        if (! user) {
            return callback(null, false, 'User does not exists');
        }
        if (hash(password) !== user.password) {
            return callback(null, false, 'Invalid password');
        }
        // The username and password should be given here 
        callback(null, {
            username: username,
            password: user.password
        });
    });
});:

flowee.use(auth.authenticate({
    expires: '2 hours',
    authRoute: 'auth-token',
    authTokenHash: {
        algorithm: 'sha256',
        salt: 'saltiness'
    }
});

flowee.start(model, function(server, router) {
  ..
</code></pre>

<h2>
<a id="user-content-ratelimiting" class="anchor" href="#ratelimiting" aria-hidden="true"><span class="octicon octicon-link"></span></a>Ratelimiting</h2>

<p>try <a href="https://www.npmjs.com/package/ratelimit-middleware">ratelimit-middleware</a></p>

<h2>
<a id="user-content-why--philosophy" class="anchor" href="#why--philosophy" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why / Philosophy</h2>

<p>Take a look at <a href="http://blog.jeffdouglas.com/2015/07/07/roll-your-own-api-vs-loopback">loopback</a>, <a href="http://meteor.com">meteor</a>, <a href="http://cleverstack.io">cleverstack</a>. 
Now imagine lightweight.
Flowee likes to focus on:</p>

<ul>
<li>lightweight and fast to install</li>
<li>json driven instead of frameworkspecific (file)conventions</li>
<li>http framework agnostic</li>
<li>allow re-usage of middleware from http frameworks like express/restify etc</li>
<li>no cli tools, just code: build and understand your own cli tools</li>
</ul>
<hr>
<center>
  generated at Mon Dec 14 22:54:21 CET 2015
</center>
</body>
</html>